#CREATE GEN BLOCK AND TX
cd /fabric
export FABRIC_CFG_PATH=$PWD

export CORE_PEER_MSPCONFIGPATH=/fabric/ca/client/peerOrganizations/harvx/users/admin/msp/
export CORE_PEER_LOCALMSPID=harvxMSP
export CORE_PEER_ADDRESS=peer1-harvx.grainchain.io:7051
export CORE_PEER_TLS_ROOTCERT_FILE=/fabric/ca/client/peerOrganizations/harvx/peers/peer1-harvx.grainchain.io/tls-msp/tlscacerts/tls-0-0-0-0-7052.pem
export CORE_PEER_PROFILE_ENABLED=false
export CORE_PEER_TLS_ENABLED=true
export CHANNEL_NAME=grainchainchannel
export CORE_PEER_TLS_ENABLED=true

cd /fabric
configtxgen -profile OrgsOrdererGenesis -outputBlock ./genesis.block -channelID syschannel
configtxgen -profile OrgsChannel -outputCreateChannelTx ./channel.tx -channelID grainchainchannel

export FABRIC_CFG_PATH=""
#START PEERS ODERERS THEN ->CREATE CHANNEL
peer channel create -c grainchainchannel -f /fabric/channel.tx -o orderer1.grainchain.io:7050 --outputBlock /fabric/mychannel.block --tls --cafile /fabric/ca/client/peerOrganizations/harvx/msp/tlscacerts/ca-cert.pem

peer channel join -b /fabric/mychannel.block


export CC_LANGUAGE=node
export PACKAGE_NAME=gcnodecc
export CC_CHANNEL_ID=grainchainchannel
export CC_LABEL=gcnodecc.1.0-1.0
export TLS_PARAMETERS=--tls
export CC2_INIT_REQUIRED=--init-required
export CC_CONSTRUCTOR='{"Args":[]}'
export GOPATH=/fabric/gopath
export ORDERER_ADDRESS=orderer1.grainchain.io:7050
export CC_NAME=gcnodecc
export CC2_PACKAGE_FOLDER=./package
export CC_PATH="/fabric/gopath/src/gc_node_granular_dac"
export TLS_CA_CERT=/fabric/ca/client/peerOrganizations/harvx/msp/tlscacerts/ca-cert.pem

cd /fabric
mkdir -p /fabric/package
peer lifecycle chaincode package $CC2_PACKAGE_FOLDER/$PACKAGE_NAME -p $CC_PATH --label=$CC_LABEL -l $CC_LANGUAGE

peer lifecycle chaincode install  $CC2_PACKAGE_FOLDER/$PACKAGE_NAME --tls --cafile /fabric/ca/client/peerOrganizations/harvx/msp/tlscacerts/ca-cert.pem

peer lifecycle chaincode queryinstalled

export CC2_SEQUENCE=1

export PACKAGE_ID="gcnodecc.1.0-1.0:41a7d5a59545f49321229b1cd8aa1184eeb7b1d1f64a213402945e5af5fb377e"

peer lifecycle chaincode approveformyorg --channelID grainchainchannel  --name $CC_NAME --version 1 --package-id $PACKAGE_ID --sequence $CC2_SEQUENCE $CC2_INIT_REQUIRED -o $ORDERER_ADDRESS $TLS_PARAMETERS --waitForEvent --cafile /fabric/ca/client/peerOrganizations/harvx/msp/tlscacerts/ca-cert.pem

peer lifecycle chaincode commit -C grainchainchannel -n $CC_NAME -v 1 \
                --sequence $CC2_SEQUENCE  $CC2_INIT_REQUIRED    --waitForEvent \
                --tls --cafile /fabric/ca/client/peerOrganizations/harvx/msp/tlscacerts/ca-cert.pem


peer chaincode invoke  -C grainchainchannel -n $CC_NAME -c $CC_CONSTRUCTOR --isInit --waitForEvent -o $ORDERER_ADDRESS $TLS_PARAMETERS --cafile /fabric/ca/client/peerOrganizations/harvx/msp/tlscacerts/ca-cert.pem

